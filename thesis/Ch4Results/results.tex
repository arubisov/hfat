\chapter{Results}

In this chapter we explore the continuous time and discrete time model dynamics, and perform in-sample and out-of-sample backtests to compare the performance of the three naive trading strategies along with the continuous and discrete time solutions to the stochastic optimal control problem.

\section{Calibration}

All tests in this chapter were run using the following global set of parameters:

\begin{tabular}{lll}
$\Delta t_S$ & 1000ms & desc \\
$\Delta t_I$ & 1000ms & desc \\
$\#_{bins}$ & 5 & desc \\
$\kappa$ & 100 & desc \\
\end{tabular}

For each daily calibration, we then computed the remaining parameters utilizing the following formulae: 

\begin{tabular}{lll}
$\mat{G}$ & \autoref{eq:MLEG} & infinitesimal generator matrix \\
$\mat{P}$ & \autoref{eq:CTMCPG} & transition probability matrix \\
$\mu^\pm$ & \autoref{eq:MLElambda} & market order arrival intensities \\
\end{tabular}

Additionally, $xi$ was computed as half of the simple average of the bid-ask spread observed during the trading day, rounded to the nearest half-cent; and the imbalance bins $\rho$ were computed as the partitioning of the interval $[-1,1]$ into percentile bins symmetric around zero, where the percentile interval was $100 \div \#_{bins}$.

As was mentioned in Chapter 2, the exploratory data analysis done on the data made use of an unorthodox Markov chain, where its state at time $t$ was actually not determinable at time $t$ because the price change $\Delta S(t)$ was computed over the \emph{future} time interval $\Delta t_S$. (See \autoref{sec:2DCTMC}.) In the optimal stochastic control formulations, the Markov chain was defined instead such the price change was computed over the \emph{past} interval $\Delta t_S$. However, it was of interest to explore what results would be obtained if the calibration was still done using the non $\cF$-predictable method. A justification for doing so is that in a given Markov state $Z$, there is a state-dependent arrival rate of price updates, and there is a state-dependent distribution of jumps when a price update occurs. So that although the price change is measured over the future when calibrating, this really is a way of getting at the state-dependence of those price changes. In the following tests, this calibration method is denoted `/w nFPC', standing for `non-$\cF$-predictable calibration'.

\section{In-Sample Backtesting}

For in-sample backtesting, calibration was run for each ticker and each trading day of 2013, and backtesting was then done for each strategy using the same day's calibration. Each backtest would yield the end of day PnL, average inventory held during the day, and the number of executed market orders and filled limit orders. In \autoref{tbl:insampleFARONTAP} and \autoref{tbl:insampleORCLINTC} we show performance values for several metrics of interest. In \autoref{fig:insample} compares the day-over-day performance of the various strategies. 

\fxnote{change from bar to daily plot}
\begin{figure}
  \centering
  \setlength\figureheight{0.75\linewidth} 
  \setlength\figurewidth{0.75\linewidth}
  \tikzsetnextfilename{insampleds1}
  \input{Figs/insampleds1.tikz}
  \caption{Backtest strategy comparison}
  \label{fig:insample}
\end{figure}

\fxnote{tables have to be rerun: break out num of trades into MO and LO. stoch ctrl only, naive is obvious}
\begin{sidewaystable}
\centering
\ra{1.2}
\begin{tabular}{@{} *{10}{r} @{}}
\toprule
Strategy & Return & Sharpe & Trades & Inv & \% Win & Avg Loss & Max Loss & Avg Win & Max Win \\
\midrule
\multicolumn{10}{l}{\texttt{FARO}} \\
Naive & -0.879 & -0.808 & 413 & 0.47 & 0.07 & -1.013 & -7.109 & 0.844 & 5.715 \\ 
Naive+ & 0.101 & 0.107 & 213 & 2.45 & 0.74 & -0.559 & -8.797 & 0.320 & 5.336 \\ 
Naive++ & 0.002 & 0.021 & 7 & 0.17 & 0.50 & -0.025 & -0.842 & 0.024 & 0.320 \\ 
Cont. Stoch. Ctrl & -0.059 & -0.551 & 201 & 0.09 & 0.18 & -0.077 & -0.912 & 0.020 & 0.071 \\ 
Dscr. Stoch. Ctrl & -0.064 & -0.695 & 210 & -0.02 & 0.08 & -0.075 & -0.914 & 0.050 & 0.440 \\ 
Cont. Stoch. Ctrl w/ NMC & -0.063 & -0.571 & 204 & 0.08 & 0.14 & -0.077 & -1.161 & 0.019 & 0.077 \\ 
Dscr. Stoch. Ctrl w/ NMC & -0.060 & -0.662 & 209 & -0.03 & 0.09 & -0.072 & -0.716 & 0.060 & 0.539 \\[2ex]
\multicolumn{10}{l}{\texttt{NTAP}} \\
Naive & -0.188 & -0.316 & 842 & -9.81 & 0.23 & -0.391 & -3.238 & 0.481 & 3.524 \\ 
Naive+ & 0.388 & 0.169 & 3562 & -9.73 & 0.74 & -1.880 & -19.367 & 1.140 & 10.201 \\ 
Naive++ & -0.005 & -0.012 & 157 & -0.90 & 0.54 & -0.189 & -2.888 & 0.151 & 2.558 \\ 
Cont. Stoch. Ctrl & -0.006 & -0.062 & 2265 & 0.40 & 0.56 & -0.083 & -0.441 & 0.053 & 0.215 \\ 
Dscr. Stoch. Ctrl & 0.099 & 0.767 & 1872 & 4.74 & 0.86 & -0.046 & -0.126 & 0.121 & 1.042 \\ 
Cont. Stoch. Ctrl w/ NMC & -0.141 & -0.951 & 2897 & 0.65 & 0.14 & -0.172 & -0.935 & 0.047 & 0.244 \\ 
Dscr. Stoch. Ctrl w/ NMC & 0.121 & 0.881 & 1738 & 2.82 & 0.89 & -0.045 & -0.139 & 0.140 & 0.962 \\ 
\bottomrule
\end{tabular}
\caption{Resultz}
\label{tbl:insampleFARONTAP}
\end{sidewaystable}

\begin{sidewaystable}
\centering
\ra{1.2}
\begin{tabular}{@{} *{10}{r} @{}}
\toprule
Strategy & Return & Sharpe & Trades & Inv & \% Win & Avg Loss & Max Loss & Avg Win & Max Win \\
\midrule
\multicolumn{10}{l}{\texttt{ORCL}} \\
Naive & -0.105 & -0.253 & 484 & 1.40 & 0.28 & -0.270 & -1.837 & 0.308 & 2.180 \\ 
Naive+ & -0.034 & -0.011 & 4086 & -55.18 & 0.61 & -2.322 & -17.501 & 1.402 & 18.400 \\ 
Naive++ & 0.002 & 0.006 & 132 & 0.61 & 0.52 & -0.152 & -0.798 & 0.142 & 2.636 \\ 
Cont. Stoch. Ctrl & 0.115 & 1.348 & 1874 & 1.94 & 0.92 & -0.061 & -0.217 & 0.127 & 0.521 \\ 
Dscr. Stoch. Ctrl & 0.135 & 1.620 & 1898 & 3.93 & 0.98 & -0.043 & -0.063 & 0.137 & 0.515 \\ 
Cont. Stoch. Ctrl w/ NMC & -0.010 & -0.100 & 2455 & 1.32 & 0.48 & -0.082 & -0.478 & 0.066 & 0.503 \\ 
Dscr. Stoch. Ctrl w/ NMC & 0.144 & 1.501 & 1759 & 2.85 & 0.97 & -0.023 & -0.032 & 0.148 & 0.573 \\[2ex]
\multicolumn{10}{l}{\texttt{INTC}} \\
Naive & -0.082 & -0.228 & 258 & -5.21 & 0.33 & -0.245 & -1.465 & 0.249 & 1.425 \\ 
Naive+ & 0.365 & 0.134 & 3962 & -32.50 & 0.63 & -2.097 & -11.202 & 1.759 & 11.669 \\ 
Naive++ & -0.001 & -0.003 & 74 & -0.84 & 0.48 & -0.136 & -1.314 & 0.140 & 1.264 \\ 
Cont. Stoch. Ctrl & 0.214 & 2.159 & 1577 & 5.17 & 0.97 & -0.121 & -0.213 & 0.220 & 0.487 \\ 
Dscr. Stoch. Ctrl & 0.232 & 2.528 & 1642 & 4.48 & 0.98 & -0.217 & -0.217 & 0.233 & 0.611 \\ 
Cont. Stoch. Ctrl w/ NMC & 0.114 & 1.218 & 1894 & 2.01 & 0.90 & -0.061 & -0.244 & 0.131 & 0.416 \\ 
Dscr. Stoch. Ctrl w/ NMC &  0.226 & 2.202 & 1569 & 4.28 & 0.98 & -0.220 & -0.220 & 0.228 & 0.650 \\ 
\bottomrule
\end{tabular}
\caption{Resultz}
\label{tbl:insampleORCLINTC}
\end{sidewaystable}

\fxnote{commentary needed. compare stoch methods}

\section{Out-of-Sample Backtesting}
\subsection{Weekday Calibration}
The first type of out-of-sample backtesting done was to calibrate for each ticker and each trading day of 2013, and to use the results to backtest on the date given by the calibration date shifted forward 7 days. Thus, the calibration obtained on Monday, January 2, 2013 would be used to backtest on Monday, January 9, 2013. Performance values are given in tables \autoref{tbl:oosweeklyFARONTAP} and \autoref{tbl:oosweeklyORCLINTC}, and \autoref{fig:oosweekly} compares the day-over-day performance of the various strategies. 

\fxnote{commentary needed. compare stoch methods}

\subsection{Annual Calibration}
The second type of out-of-sample backtesting done was to calibrate using data amalgamated from the entire 2013 trading year. This was a very rich calibration source, as it effectively ensured that every possible state of the Markov chain would have had sufficient observations. Further, this caused us to fix the imbalance bins $\rho$ for the entire year, rather than having bins (and hence what it means to be `heavy buy imbalance' and `neutral imbalance') vary each day. Performance values are given in tables \autoref{tbl:oosannualFARONTAP} and \autoref{tbl:oosannualORCLINTC}, and \autoref{fig:oosannual} compares the day-over-day performance of the various strategies. 

\fxnote{commentary needed. compare stoch methods}

\section{Dynamics of \texorpdfstring{${\delta^{\pm}}^*$}{delta}}

