\chapter{Results}

In this chapter we explore the dynamics of the continuous time and discrete time models, and perform in-sample and out-of-sample backtests to compare the performance of the continuous and discrete time solutions to the stochastic optimal control problem.

\section{Calibration}

All tests in this chapter were run using the following global set of parameters:
\begin{center}
\begin{tabular}{rll}
time window for computing price change & $\Delta t_S$ & 1000ms \\
time window for averaging order imbalance & $\Delta t_I$ & 1000ms \\
number of imbalance bins & $\#_{bins}$ & 5 \\
fill probability constant & $\kappa$ & 100 \\
&& \\
\multicolumn{3}{p{\linewidth}}{For each daily calibration, we then computed the remaining parameters utilizing the following formulae:} \\
&& \\
infinitesimal generator matrix & $\mat{G}$ & \autoref{eq:MLEG} \\
transition probability matrix & $\mat{P}$ & \autoref{eq:CTMCPG} \\
market order arrival intensities & $\mu^\pm$ & \autoref{eq:MLElambda}
\end{tabular}
\end{center}

Additionally, $\xi$ was computed as half of the simple average of the bid-ask spread observed during the trading day, rounded to the nearest half-cent; and the imbalance bins $\rho$ were computed as the partitioning of the interval $[-1,1]$ into percentile bins symmetric around zero, where the percentile interval was $100 \div \#_{bins}$.

As was mentioned in Chapter 2, the exploratory data analysis done on the data made use of an unorthodox Markov chain, where its state at time $t$ was actually not determinable at time $t$ because the price change $\Delta S(t)$ was computed over the \emph{future} time interval $\Delta t_S$. (See \autoref{sec:2DCTMC}.) In the optimal stochastic control formulations, the Markov chain was defined instead such the price change was computed over the \emph{past} interval $\Delta t_S$. However, it was of interest to explore what results would be obtained if the calibration was still done using the non $\cF$-predictable method. A justification for doing so is that in a given Markov state $Z$, there is a state-dependent arrival rate of price updates, and there is a state-dependent distribution of jumps when a price update occurs. So that although the price change is measured over the future when calibrating, this really is a way of getting at the state-dependence of those price changes. In the following tests, this calibration method is denoted `w nFPC', standing for `with non-$\cF$-predictable calibration'.

\section{Dynamics of \texorpdfstring{${\delta^{\pm}}^*$}{delta}}

We have solved the same stochastic control problem using both continuous and discrete time, which have yielded markedly different resulting formulae for the optimal limit order posting depths. In this section we explore the calibrated results obtained on an in-sample backtest on \texttt{ORCL}, both calibrating and backtesting using data from 2013-05-15. The dynamics of $\delta^\pm$ were obtained using a time-to-maturity of 100sec to best depict the behavior as we approached the end of day trading; as the time-to-maturity horizon increases, the postings depths tend to stabilize. 

\begin{figure}
\centering
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dp_cts_z1}
  \input{Figs/dp_cts_z1.tikz}
  \caption{Continuous Time}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dp_dscr_z1}
  \input{Figs/dp_dscr_z1.tikz} 
  \caption{Discrete Time}
\end{subfigure}\\
\vspace{1cm}
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dp_cts_nFPC_z1}
  \input{Figs/dp_cts_nFPC_z1.tikz} 
  \caption{Continuous Time w/ nFPC}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dp_dscr_nFPC_z1}
  \input{Figs/dp_dscr_nFPC_z1.tikz} 
  \caption{Discrete Time w/ nFPC}
\end{subfigure}\\

\leavevmode\smash{\makebox[0pt]{\hspace{-7em}% HORIZONTAL POSITION           
  \rotatebox[origin=l]{90}{\hspace{20em}% VERTICAL POSITION
    Depth $\delta^+$}%
}}\hspace{0pt plus 1filll}\null

Time (s)

\vspace{1cm}
\begin{subfigure}{\linewidth}
  \centering
  \tikzsetnextfilename{deltalegend}
  \input{Figs/deltalegend.tikz} 
\end{subfigure}%
  \caption{Optimal buy depths $\delta^{+}$ for Markov state $Z=(\rho = -1, \Delta S = -1)$, implying heavy imbalance in favor of sell pressure, and having previously seen a downward price change. We expect the midprice to fall.}
  \label{fig:comp_dp_z1}
\end{figure}

\begin{figure}
\centering
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dp_cts_z8}
  \input{Figs/dp_cts_z8.tikz}
  \caption{Continuous Time}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dp_dscr_z8}
  \input{Figs/dp_dscr_z8.tikz} 
  \caption{Discrete Time}
\end{subfigure}\\
\vspace{1cm}
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dp_cts_nFPC_z8}
  \input{Figs/dp_cts_nFPC_z8.tikz} 
  \caption{Continuous Time w/ nFPC}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dp_dscr_nFPC_z8}
  \input{Figs/dp_dscr_nFPC_z8.tikz} 
  \caption{Discrete Time w/ nFPC}
\end{subfigure}\\

\leavevmode\smash{\makebox[0pt]{\hspace{-7em}% HORIZONTAL POSITION           
  \rotatebox[origin=l]{90}{\hspace{20em}% VERTICAL POSITION
    Depth $\delta^+$}%
}}\hspace{0pt plus 1filll}\null

Time (s)

\vspace{1cm}
\begin{subfigure}{\linewidth}
  \centering
  \tikzsetnextfilename{deltalegend}
  \input{Figs/deltalegend.tikz} 
\end{subfigure}%
  \caption{Optimal buy depths $\delta^+$ for Markov state $Z=(\rho = 0, \Delta S = 0)$, implying neutral imbalance and no previous price change. We expect no change in midprice.}
  \label{fig:comp_dp_z8}
\end{figure}

\begin{figure}
\centering
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dp_cts_z15}
  \input{Figs/dp_cts_z15.tikz}
  \caption{Continuous Time}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dp_dscr_z15}
  \input{Figs/dp_dscr_z15.tikz} 
  \caption{Discrete Time}
\end{subfigure}\\
\vspace{1cm}
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dp_cts_nFPC_z15}
  \input{Figs/dp_cts_nFPC_z15.tikz} 
  \caption{Continuous Time w/ nFPC}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dp_dscr_nFPC_z15}
  \input{Figs/dp_dscr_nFPC_z15.tikz} 
  \caption{Discrete Time w/ nFPC}
\end{subfigure}\\

\leavevmode\smash{\makebox[0pt]{\hspace{-7em}% HORIZONTAL POSITION           
  \rotatebox[origin=l]{90}{\hspace{20em}% VERTICAL POSITION
    Depth $\delta^+$}%
}}\hspace{0pt plus 1filll}\null

Time (s)

\vspace{1cm}
\begin{subfigure}{\linewidth}
  \centering
  \tikzsetnextfilename{deltalegend}
  \input{Figs/deltalegend.tikz} 
\end{subfigure}%
  \caption{Optimal buy depths $\delta^{+}$ for Markov state $Z=(\rho = +1, \Delta S = +1)$, implying heavy imbalance in favor of buy pressure, and having previously seen an upward price change. We expect the midprice to rise.}
  \label{fig:comp_dp_z15}
\end{figure}

\fxnote{So which of these plots do we like better? the 9 choices of q, or the colormap version of q?}
\begin{figure}
\centering
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{testdp_cts_z1}
  \input{Figs/test/dp_cts_z1.tikz}
  \caption{Continuous Time}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{testdp_dscr_z1}
  \input{Figs/test/dp_dscr_z1.tikz} 
  \caption{Discrete Time}
\end{subfigure}\\
\vspace{1cm}
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{testdp_cts_nFPC_z1}
  \input{Figs/test/dp_cts_nFPC_z1.tikz}
  \caption{Continuous Time}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{testdp_dscr_nFPC_z1}
  \input{Figs/test/dp_dscr_nFPC_z1.tikz} 
  \caption{Discrete Time}
\end{subfigure}\\

\leavevmode\smash{\makebox[0pt]{\hspace{-7em}% HORIZONTAL POSITION           
  \rotatebox[origin=l]{90}{\hspace{20em}% VERTICAL POSITION
    Depth $\delta^+$}%
}}\hspace{0pt plus 1filll}\null

Time (s)

\vspace{1cm}
\begin{subfigure}{\linewidth}
  \centering
  \tikzsetnextfilename{altdeltalegend}
  \input{Figs/altdeltalegend.tikz} 
\end{subfigure}%
  \caption{Optimal buy depths $\delta^{+}$ for Markov state $Z=(\rho = -1, \Delta S = -1)$, implying heavy imbalance in favor of sell pressure, and having previously seen a downward price change. We expect the midprice to fall.}
  \label{fig:comp_dp_z1_test}
\end{figure}

\begin{figure}
\centering
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{testdp_cts_z8}
  \input{Figs/test/dp_cts_z8.tikz}
  \caption{Continuous Time}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{testdp_dscr_z8}
  \input{Figs/test/dp_dscr_z8.tikz} 
  \caption{Discrete Time}
\end{subfigure}\\
\vspace{1cm}
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{testdp_cts_nFPC_z8}
  \input{Figs/test/dp_cts_nFPC_z8.tikz}
  \caption{Continuous Time}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{testdp_dscr_nFPC_z8}
  \input{Figs/test/dp_dscr_nFPC_z8.tikz} 
  \caption{Discrete Time}
\end{subfigure}\\

\leavevmode\smash{\makebox[0pt]{\hspace{-7em}% HORIZONTAL POSITION           
  \rotatebox[origin=l]{90}{\hspace{20em}% VERTICAL POSITION
    Depth $\delta^+$}%
}}\hspace{0pt plus 1filll}\null

Time (s)

\vspace{1cm}
\begin{subfigure}{\linewidth}
  \centering
  \tikzsetnextfilename{altdeltalegend}
  \input{Figs/altdeltalegend.tikz} 
\end{subfigure}%
  \caption{Optimal buy depths $\delta^+$ for Markov state $Z=(\rho = 0, \Delta S = 0)$, implying neutral imbalance and no previous price change. We expect no change in midprice.}
  \label{fig:comp_dp_z8_test}
\end{figure}

\begin{figure}
\centering
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{testdp_cts_z15}
  \input{Figs/test/dp_cts_z15.tikz}
  \caption{Continuous Time}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{testdp_dscr_z15}
  \input{Figs/test/dp_dscr_z15.tikz} 
  \caption{Discrete Time}
\end{subfigure}\\
\vspace{1cm}
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{testdp_cts_nFPC_z15}
  \input{Figs/test/dp_cts_nFPC_z15.tikz}
  \caption{Continuous Time}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{testdp_dscr_nFPC_z15}
  \input{Figs/test/dp_dscr_nFPC_z15.tikz} 
  \caption{Discrete Time}
\end{subfigure}\\

\leavevmode\smash{\makebox[0pt]{\hspace{-7em}% HORIZONTAL POSITION           
  \rotatebox[origin=l]{90}{\hspace{20em}% VERTICAL POSITION
    Depth $\delta^+$}%
}}\hspace{0pt plus 1filll}\null

Time (s)

\vspace{1cm}
\begin{subfigure}{\linewidth}
  \centering
  \tikzsetnextfilename{altdeltalegend}
  \input{Figs/altdeltalegend.tikz} 
\end{subfigure}%
  \caption{Optimal buy depths $\delta^{+}$ for Markov state $Z=(\rho = +1, \Delta S = +1)$, implying heavy imbalance in favor of buy pressure, and having previously seen an upward price change. We expect the midprice to rise.}
  \label{fig:comp_dp_z15_test}
\end{figure}
The first notable conclusion we can make is the symmetry that has emerged between $\delta^+$ and $\delta^-$ in `opposite' Markov states. This is evident when comparing $\delta^+$ in $Z=(-1,-1)$ (\autoref{fig:comp_dp_z1}) with $\delta^-$ in $Z=(+1,+1)$ (\autoref{fig:comp_dm_z15}), $\delta^+$ in $Z=(0,0)$ (\autoref{fig:comp_dp_z8}) with $\delta^-$ in $Z=(0,0)$ (\autoref{fig:comp_dm_z8}), and $\delta^+$ in $Z=(+1,+1)$ (\autoref{fig:comp_dp_z15}) with $\delta^-$ in $Z=(-1,-1)$ (\autoref{fig:comp_dm_z1}). Thus, we focus the discussion here on the behavior of $\delta^+$.

In this calibration we have taken $\kappa=100$ and $\xi = 0.005$. From \eqref{eq:ctsBuycondition}, we thus know that a necessary condition for a buy market order to be executed is ${\delta^+}^* =  \frac{1}{\kappa} - 2 \xi = 0$.

{\bf Markov State $Z=(-1,-1)$ (\autoref{fig:comp_dp_z1})} \\
{\bf Cts versus Cts w nFPC:} For $q \geq 0$, both strategies post aggressive bid depths that suggest an inclination to buy. The nFPC strategy is less aggressive for $q<0$, posting closer to zero depth only for larger short positions.  \\
{\bf Dscr versus Dscr w nFPC:} The behaviour of these two calibrations is very similar. Both models show a discontinuity in dynamics at $q=0$, where at $q=-1$ it is posting at maximal depth, at $q=0$ it jumps to approximately \$0.006, and at $q=1$ again jumps lower. Otherwise, the nFPC strategy posts slightly more aggressively only when $q=1$ or 2. \\
{\bf Cts vs Dscr:} These models produce behaviours that are worlds apart. Whereas the Cts model seems to be saying that it wants to take this opportunity to go long, perhaps stocking up inventory while prices are low, the Dscr strategy suggests it's pulling out and avoiding purchasing. 

{\bf Markov State $Z=(0,0)$ (\autoref{fig:comp_dp_z8})}\\
Here we see near identical model behaviour. Similarities or correlations in backtesting performance can likely be attributed to this behaviour, as the majority of the day is spent in a Markov state for which $\Delta S = 0$, as seen here. (Recall that $\rho$, by contrast, is computed via evenly spaced percentiles symmetric around zero, so that time spent in each imbalance state is evenly distributed.)

{\bf Markov State $Z=(+1,+1)$ (\autoref{fig:comp_dp_z15})}\\
{\bf Cts versus Cts w nFPC:} We see a nearly symmetric behaviour compared with the opposite Markov state. Here for $q \leq 0$, both strategies post maximal bid depths, suggesting a disinclination toward buying. The nFPC strategy is more aggressive for $q>0$ and small inventory positions.\\
{\bf Dscr versus Dscr w nFPC:} Again these calibrations yield very similar behaviours, and as in the Cts case, it is near opposite to what was seen in the opposite Markov state.\\
{\bf Cts vs Dscr:} As before, these two models display near opposite behaviours between each other. The Dscr model is posting aggressive depths near zero in an attempt to purchase, while the Cts model is posting deeper into the book to avoid purchasing.

Finally, we note that we see stability in the posting depths beyond a time horizon of 600 seconds. This is consistent with the findings in \autoref{tbl:pvalues}, where we saw that the transition probability matrix $\mat{P}(t)$ converged for $\texttt{ORCL}$ within 404 timesteps of 1s each. \fxnote{If gonna use the colorbar, change to INTC and 771 timesteps, but note error threshold $10^{-10}$}

\begin{figure}
\centering
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dm_cts_z1}
  \input{Figs/dm_cts_z1.tikz}
  \caption{Continuous Time}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dm_dscr_z1}
  \input{Figs/dm_dscr_z1.tikz} 
  \caption{Discrete Time}
\end{subfigure}\\
\vspace{1cm}
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dm_cts_nFPC_z1}
  \input{Figs/dm_cts_nFPC_z1.tikz} 
  \caption{Continuous Time w/ nFPC}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dm_dscr_nFPC_z1}
  \input{Figs/dm_dscr_nFPC_z1.tikz} 
  \caption{Discrete Time w/ nFPC}
\end{subfigure}\\

\leavevmode\smash{\makebox[0pt]{\hspace{-7em}% HORIZONTAL POSITION           
  \rotatebox[origin=l]{90}{\hspace{20em}% VERTICAL POSITION
    Depth $\delta^-$}%
}}\hspace{0pt plus 1filll}\null

Time (s)

\vspace{1cm}
\begin{subfigure}{\linewidth}
  \centering
  \tikzsetnextfilename{deltalegend}
  \input{Figs/deltalegend.tikz} 
\end{subfigure}%
  \caption{Optimal sell depths $\delta^{-}$ for Markov state $Z=(\rho = -1, \Delta S = -1)$, implying heavy imbalance in favor of sell pressure, and having previously seen a downward price change. We expect the midprice to fall.}
  \label{fig:comp_dm_z1}
\end{figure}

\begin{figure}
\centering
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dm_cts_z8}
  \input{Figs/dm_cts_z8.tikz}
  \caption{Continuous Time}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dm_dscr_z8}
  \input{Figs/dm_dscr_z8.tikz} 
  \caption{Discrete Time}
\end{subfigure}\\
\vspace{1cm}
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dm_cts_nFPC_z8}
  \input{Figs/dm_cts_nFPC_z8.tikz} 
  \caption{Continuous Time w/ nFPC}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dm_dscr_nFPC_z8}
  \input{Figs/dm_dscr_nFPC_z8.tikz} 
  \caption{Discrete Time w/ nFPC}
\end{subfigure}\\

\leavevmode\smash{\makebox[0pt]{\hspace{-7em}% HORIZONTAL POSITION           
  \rotatebox[origin=l]{90}{\hspace{20em}% VERTICAL POSITION
    Depth $\delta^-$}%
}}\hspace{0pt plus 1filll}\null

Time (s)

\vspace{1cm}
\begin{subfigure}{\linewidth}
  \centering
  \tikzsetnextfilename{deltalegend}
  \input{Figs/deltalegend.tikz} 
\end{subfigure}%
  \caption{Optimal sell depths $\delta^-$ for Markov state $Z=(\rho = 0, \Delta S = 0)$, implying neutral imbalance and no previous price change. We expect no change in midprice.}
  \label{fig:comp_dm_z8}
\end{figure}

\begin{figure}
\centering
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dm_cts_z15}
  \input{Figs/dm_cts_z15.tikz}
  \caption{Continuous Time}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dm_dscr_z15}
  \input{Figs/dm_dscr_z15.tikz} 
  \caption{Discrete Time}
\end{subfigure}\\
\vspace{1cm}
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dm_cts_nFPC_z15}
  \input{Figs/dm_cts_nFPC_z15.tikz} 
  \caption{Continuous Time w/ nFPC}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{dm_dscr_nFPC_z15}
  \input{Figs/dm_dscr_nFPC_z15.tikz} 
  \caption{Discrete Time w/ nFPC}
\end{subfigure}\\

\leavevmode\smash{\makebox[0pt]{\hspace{-7em}% HORIZONTAL POSITION           
  \rotatebox[origin=l]{90}{\hspace{20em}% VERTICAL POSITION
    Depth $\delta^-$}%
}}\hspace{0pt plus 1filll}\null

Time (s)

\vspace{1cm}
\begin{subfigure}{\linewidth}
  \centering
  \tikzsetnextfilename{deltalegend}
  \input{Figs/deltalegend.tikz} 
\end{subfigure}%
  \caption{Optimal sell depths $\delta^{-}$ for Markov state $Z=(\rho = +1, \Delta S = +1)$, implying heavy imbalance in favor of buy pressure, and having previously seen an upward price change. We expect the midprice to rise.}
  \label{fig:comp_dm_z15}
\end{figure}

\FloatBarrier
\subsection{Comparing Performance}

\begin{figure}
  \centering
\begin{subfigure}{\linewidth}
  \setlength\figureheight{0.5\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{ORCL_comp4stoch}
  \input{Figs/ORCL_comp4stoch.tikz}
  \caption{Performance comparison of the four stochastic control methods.}
  \label{fig:ORCL_comp4stoch}
\end{subfigure}\\
\vspace{1cm}
\begin{subfigure}{\linewidth}
  \centering
  \setlength\figureheight{0.5\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{ORCL_comp4stoch_inv}
  \input{Figs/ORCL_comp4stoch_inv.tikz}
  \caption{Inventory comparison of the four stochastic control methods.}
  \label{fig:ORCL_comp4stoch_inv}
\end{subfigure}%
\caption{Comparison of the four stochastic control methods.}
\end{figure}
In \autoref{fig:ORCL_comp4stoch} we plot the normalized PnL for the four strategies, calibrated and backtested using data for \texttt{ORCL} from 2013-05-15. At a glance the four plots show obvious similarities in trajectory, as well as in the distinct spikes between 13h and 14.5h. Nevertheless the correlation of arithmetic returns, \autoref{tbl:ORCL_comp4stoch_corr}, shows that the strategies' returns were uncorrelated. Indeed, while the overall paths are similar, on close inspection the individual returns do show markedly different behavior.
\begin{table}[H]
\centering
\ra{1.2}
\begin{tabular}{@{} r *{4}{c} @{}}
\toprule
& Cts & \cellbreak{t}{c}{Cts \\ w nFPC} & Dscr & \cellbreak{t}{c}{Dscr \\ w nFPC} \\
\cmidrule{2-5}
Cts          &  1.0000  & & & \\
Cts w nFPC   & -0.0109  &  1.0000 &  & \\
Dscr         & -0.0120  &  0.0122 &   1.0000 &  \\
Dscr w nFPC  & -0.0015  &  0.0034 &  -0.0165 &   1.0000 \\
\bottomrule
\end{tabular}
\caption{Correlation of returns}
\label{tbl:ORCL_comp4stoch_corr}
\end{table}
However, we find instead that the returns are co-integrated. On running the Engle-Granger cointegration test with statistics computed using an augmented Dickey-Fuller test of residuals, the $\tau$-test and $z$-test both returned $p$-values of 0.001, thus rejecting the null hypothesis of no co-integration. Indeed, the co-integration relation plotted in \autoref{fig:cointeg_relation} displays stationarity, thus confirming the existence of a co-integration relation.
\begin{figure}[H]
  \centering
  \setlength\figureheight{0.2\linewidth} 
  \setlength\figurewidth{0.35\linewidth}
  \tikzsetnextfilename{cointeg_relation}
  \input{Figs/cointeg_relation.tikz}
  \caption{Co-integration relation of the four stochastic control methods.}
  \label{fig:cointeg_relation}
\end{figure}
From the inventory plot in \autoref{fig:ORCL_comp4stoch_inv} we see that the strategies always avoid maintaining zero inventory. This is not surprising: in both the discrete and continuous cases we found that the value function ansatz $h(t,z,q)$ was non-negative, and was equal to zero at zero inventory. The interpretation is that there is no added value to having zero inventory, whereas non-zero inventory can at worst have zero value. Thus it is always profitable, from a value-function standpoint, to have non-zero inventory. Further, we see that the strategies rarely cross the zero-inventory barrier. This is likely attributed to the backtesting algorithm itself, which gives priority to executing buy market orders above sell market orders - we suspect that once the strategy gets into either positive or negative inventory territory, the ansatz function $h$ rarely produces the circumstances to cross the inventory sign barrier by virtue of the non-linear mark-to-market behavior on either side of zero inventory.

Concerning trade execution, the number of executed market orders and filled limit orders generated by each strategy are presented in \autoref{tbl:ORCL_comp4stoch_numt}. The surge in market orders seen for the Cts w nFPC strategy can be explained by the difference in the $\delta^\pm$ plots. As mentioned already, from the stochastic analysis chapter, we know that if $q < 0 $ and $\delta^+ =0$, or if $q > 0$ and $\delta^+ = 1/\kappa$, then we execute a buy MO. Likewise, if $q < 0 $ and $\delta^- =1/\kappa$, or if $q > 0$ and $\delta^- = 0$, then we execute a sell MO. In \autoref{fig:comp_dp_z1} we see that we have $\delta^+ = 0$ for almost all inventory values, and in \autoref{fig:comp_dp_z15} we have  $\delta^+ = 1/\kappa$ for almost all inventory values. This tells us that when the Markov chain state is in one of the non-neutral states, the Cts w nFPC strategy will execute market orders when possible, as it expects prices to move in the corresponding direction. Regarding overall number of trades, it should be noted that we did not include the cost of market order execution in the stochastic control problem. Thus, actual performance would have been negatively affected in proportion to the number of market orders listed.
\begin{table}
\centering
\ra{1.2}
\begin{tabular}{@{} r *{2}{c} @{}}
\toprule
& Market Orders & Limit Orders \\
\midrule
Cts          &  536 & 1280 \\
Cts w nFPC   & 1010 & 1306 \\
Dscr         &  559 & 1285 \\
Dscr w nFPC  &  523 & 1287 \\
\bottomrule
\end{tabular}
\caption{Number of trades comparison of the four stochastic control methods.}
\label{tbl:ORCL_comp4stoch_numt}
\end{table}

To better see how the strategies differ in behaviour, in the figures that follow we show a short sample path on a fine timescale spanning about 2 minutes. In \autoref{fig:samplepath_paths} we plot the midprice path (black line), the optimal posting depths on either side of the real bid/ask prices (gray lines), our execution of market orders (dark blue and dark green), and track incoming external market orders (light blue and light green) that either fill our limit orders (solid lines) or do not (dashed lines). \autoref{fig:samplepath_depths} plots just the optimal depths as they react to the changing Markov state, allowing a better comparison of the behaviours, as well as highlighting the almost-symmetric behaviour between $\delta^+$ and $delta^-$. \autoref{fig:samplepath_pnl} and \autoref{fig:samplepath_inv} show the effect on PnL and inventory, respectively. 

\begin{figure}
\centering
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{samplepath_cts_paths}
  \input{Figs/samplepath_cts_paths.tikz}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{samplepath_dscr_paths}
  \input{Figs/samplepath_dscr_paths.tikz} 
\end{subfigure}\\
\vspace{1cm}
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{samplepath_cts_nFPC_paths}
  \input{Figs/samplepath_cts_nFPC_paths.tikz}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{samplepath_dscr_nFPC_paths}
  \input{Figs/samplepath_dscr_nFPC_paths.tikz} 
\end{subfigure}\\
\leavevmode\smash{\makebox[0pt]{\hspace{-7em}% HORIZONTAL POSITION           
  \rotatebox[origin=l]{90}{\hspace{20em}% VERTICAL POSITION
    Price}%
}}\hspace{0pt plus 1filll}\null

Time (h)

\vspace{1cm}
\begin{subfigure}{\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{samplepathslegend}
  \input{Figs/samplepathslegend.tikz}
\end{subfigure}%
  \caption{Sample paths of the optimal trading strategies, showing price, limit order posting depths, executed market orders, and filled limit orders.}
  \label{fig:samplepath_paths}
\end{figure}

\begin{figure}
\centering
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{samplepath_cts_depths}
  \input{Figs/samplepath_cts_depths.tikz}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{samplepath_dscr_depths}
  \input{Figs/samplepath_dscr_depths.tikz} 
\end{subfigure}\\
\vspace{1cm}
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{samplepath_cts_nFPC_depths}
  \input{Figs/samplepath_cts_nFPC_depths.tikz}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{samplepath_dscr_nFPC_depths}
  \input{Figs/samplepath_dscr_nFPC_depths.tikz} 
\end{subfigure}\\
\leavevmode\smash{\makebox[0pt]{\hspace{-7em}% HORIZONTAL POSITION           
  \rotatebox[origin=l]{90}{\hspace{20em}% VERTICAL POSITION
    PnL}%
}}\hspace{0pt plus 1filll}\null

Time (h)

\vspace{1cm}
\begin{subfigure}{\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{samplepathslegend}
  \input{Figs/samplepathslegend.tikz}
\end{subfigure}%
  \caption{Sample paths of the optimal trading strategies, showing price, limit order posting depths, executed market orders, and filled limit orders.}
  \label{fig:samplepath_depths}
\end{figure}

\begin{figure}
\centering
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{samplepath_cts_bookvalue}
  \input{Figs/samplepath_cts_bookvalue.tikz}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{samplepath_dscr_bookvalue}
  \input{Figs/samplepath_dscr_bookvalue.tikz} 
\end{subfigure}\\
\vspace{1cm}
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{samplepath_cts_nFPC_bookvalue}
  \input{Figs/samplepath_cts_nFPC_bookvalue.tikz}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{samplepath_dscr_nFPC_bookvalue}
  \input{Figs/samplepath_dscr_nFPC_bookvalue.tikz} 
\end{subfigure}\\
\leavevmode\smash{\makebox[0pt]{\hspace{-7em}% HORIZONTAL POSITION           
  \rotatebox[origin=l]{90}{\hspace{20em}% VERTICAL POSITION
    PnL}%
}}\hspace{0pt plus 1filll}\null

Time (h)

\vspace{1cm}%
  \caption{Sample paths of the optimal trading strategies, showing price, limit order posting depths, executed market orders, and filled limit orders.}
  \label{fig:samplepath_pnl}
\end{figure}

\begin{figure}
\centering
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{samplepath_cts_inventory}
  \input{Figs/samplepath_cts_inventory.tikz}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{samplepath_dscr_inventory}
  \input{Figs/samplepath_dscr_inventory.tikz} 
\end{subfigure}\\
\vspace{1cm}
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{samplepath_cts_nFPC_inventory}
  \input{Figs/samplepath_cts_nFPC_inventory.tikz}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{samplepath_dscr_nFPC_inventory}
  \input{Figs/samplepath_dscr_nFPC_inventory.tikz} 
\end{subfigure}\\
\leavevmode\smash{\makebox[0pt]{\hspace{-7em}% HORIZONTAL POSITION           
  \rotatebox[origin=l]{90}{\hspace{19em}% VERTICAL POSITION
    Inventory}%
}}\hspace{0pt plus 1filll}\null

Time (h)

\vspace{1cm}%
  \caption{Sample paths of the optimal trading strategies, showing price, limit order posting depths, executed market orders, and filled limit orders.}
  \label{fig:samplepath_inv}
\end{figure}

\FloatBarrier
\section{In-Sample Backtesting}

\subsection{Same-Day Calibration}
We begin our in-sample backtesting same-day calibration: calibration was run for each ticker and each trading day of 2013, and backtesting was then done for each strategy using the same day's calibration. Each backtest would yield the end of day PnL, average inventory held during the day, and the number of executed market orders and filled limit orders. In \autoref{tbl:IS_sameday} we show performance values for several metrics of interest, while \autoref{fig:IS_sameday_comp} compares the day-over-day performance of the various strategies. 

Since we are calibrating and backtesting using the same underlying data, the calibration should be best attuned to the price dynamics for that praticular day, and hence we expect the performance using same-day calibration to exceed that of the weekly offset calibration and the annual calibration (detailed in the sections that follow). Looking at the \% Win column in \autoref{tbl:IS_sameday} we see that trading on \texttt{FARO} very rarely produces positive PnL. This is not surprising and was mentioned at the conclusion of the exploratory data analysis chapter: \texttt{FARO} is highly illiquid, with daily volume hovering around 200k, and its bid-ask spread averages approximately 20 cents. This makes it never profitable to execute market orders (due to crossing the spread), and because our optimal strategies still force us to post limit orders at depths between 0 and $1/\kappa = 0.01 = 1\text{cent}$, the most probable occurrence is that our limit orders are lifted adversely. \texttt{NTAP} seems to be a borderline case for liquidity, with average volumes around 4m, and here the strategies exhibit weak regularity of profits. The most liquid stocks, \texttt{ORCL} and \texttt{NTAP}, with average volumes around 15m and 30m respectively, post extremely promising results: the stochastic control strategies produce positive EOD PnL more than 90\% of the time. The discrete time controller outperforms its continuous time counterpart, and in particular we highlight that in the case of \texttt{INTC}, we attain a very good Sharpe ratio of 2.5.

\begin{figure}
\centering
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{IS_sameday_FARO}
  \input{Figs/IS_sameday_FARO.tikz}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{IS_sameday_NTAP}
  \input{Figs/IS_sameday_NTAP.tikz} 
\end{subfigure}\\
\vspace{1cm}
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{IS_sameday_ORCL}
  \input{Figs/IS_sameday_ORCL.tikz}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{IS_sameday_INTC}
  \input{Figs/IS_sameday_INTC.tikz} 
\end{subfigure}\\

\leavevmode\smash{\makebox[0pt]{\hspace{-7em}% HORIZONTAL POSITION           
  \rotatebox[origin=l]{90}{\hspace{20em}% VERTICAL POSITION
    Normalized PnL}%
}}\hspace{0pt plus 1filll}\null

Trading Day Number of 2013

\vspace{1cm}
\begin{subfigure}{\linewidth}
  %\centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{strategylegend}
  \resizebox{\linewidth}{!}{\input{Figs/strategylegend.tikz}}
\end{subfigure}%
  \caption{End of day strategy performances: in-sample backtesting using same-day calibration.}
  \label{fig:IS_sameday_comp}
\end{figure}

\begin{table}
\centering
\ra{1.2}
\begin{tabular}{@{} *{8}{r} @{}}
\toprule
Strategy & Return & Sharpe & Trades & Inv & \% Win & Max Loss & Max Win \\
\midrule
\multicolumn{8}{l}{\texttt{FARO}} \\
Naive & -0.879 & -0.808 & 413 & 0.47 & 0.07 & -7.109 & 5.715 \\ 
Naive+ & 0.101 & 0.107 & 213 & 2.45 & 0.74 & -8.797 & 5.336 \\ 
Naive++ & 0.002 & 0.021 & 7 & 0.17 & 0.50 & -0.842 & 0.320 \\ 
Cont & -0.059 & -0.551 & 201 & 0.09 & 0.18 & -0.912 & 0.071 \\ 
Dscr & -0.064 & -0.695 & 210 & -0.02 & 0.08 & -0.914 & 0.440 \\ 
Cont w nFPC & -0.063 & -0.571 & 204 & 0.08 & 0.14 & -1.161 & 0.077 \\ 
Dscr w nFPC & -0.060 & -0.662 & 209 & -0.03 & 0.09 & -0.716 & 0.539 \\[2ex]
\multicolumn{8}{l}{\texttt{NTAP}} \\
Naive & -0.188 & -0.316 & 842 & -9.81 & 0.23 & -3.238 & 3.524 \\ 
Naive+ & 0.388 & 0.169 & 3562 & -9.73 & 0.74 & -19.367 & 10.201 \\ 
Naive++ & -0.005 & -0.012 & 157 & -0.90 & 0.54 & -2.888 & 2.558 \\ 
Cont & -0.006 & -0.062 & 2265 & 0.40 & 0.56 & -0.441 & 0.215 \\ 
Dscr & 0.099 & 0.767 & 1872 & 4.74 & 0.86 & -0.126 & 1.042 \\ 
Cont w nFPC & -0.141 & -0.951 & 2897 & 0.65 & 0.14 & -0.935 & 0.244 \\ 
Dscr w nFPC & 0.121 & 0.881 & 1738 & 2.82 & 0.89 & -0.139 & 0.962 \\[2ex]
\multicolumn{8}{l}{\texttt{ORCL}} \\
Naive & -0.105 & -0.253 & 484 & 1.40 & 0.28 & -1.837 & 2.180 \\ 
Naive+ & -0.034 & -0.011 & 4086 & -55.18 & 0.61 & -17.501 & 18.400 \\ 
Naive++ & 0.002 & 0.006 & 132 & 0.61 & 0.52 & -0.798 & 2.636 \\ 
Cont & 0.115 & 1.348 & 1874 & 1.94 & 0.92 & -0.217 & 0.521 \\ 
Dscr & 0.135 & 1.620 & 1898 & 3.93 & 0.98 & -0.063 & 0.515 \\ 
Cont w nFPC & -0.010 & -0.100 & 2455 & 1.32 & 0.48 & -0.478 & 0.503 \\ 
Dscr w nFPC & 0.144 & 1.501 & 1759 & 2.85 & 0.97 & -0.032 & 0.573 \\[2ex]
\multicolumn{8}{l}{\texttt{INTC}} \\
Naive & -0.082 & -0.228 & 258 & -5.21 & 0.33 & -1.465 & 1.425 \\ 
Naive+ & 0.365 & 0.134 & 3962 & -32.50 & 0.63 & -11.202 & 11.669 \\ 
Naive++ & -0.001 & -0.003 & 74 & -0.84 & 0.48 & -1.314 & 1.264 \\ 
Cont & 0.214 & 2.159 & 1577 & 5.17 & 0.97 & -0.213 & 0.487 \\ 
Dscr & 0.232 & 2.528 & 1642 & 4.48 & 0.98 & -0.217 & 0.611 \\ 
Cont w nFPC & 0.114 & 1.218 & 1894 & 2.01 & 0.90 & -0.244 & 0.416 \\ 
Dscr w nFPC &  0.226 & 2.202 & 1569 & 4.28 & 0.98 & -0.220 & 0.650 \\ 
\bottomrule
\end{tabular}
\caption{Averaged strategy performance results: in-sample backtesting using same-day calibration.}
\label{tbl:IS_sameday}
\end{table}

\fxnote{commentary needed. compare stoch methods}

\FloatBarrier
\subsection{Week Offset Calibration}
The next type of in-sample backtesting done was to calibrate for each ticker and each trading day of 2013, and to use the results to backtest on the date given by the calibration date shifted forward 7 days. Thus, the calibration obtained on Monday, January 2, 2013 would be used to backtest on Monday, January 9, 2013. Performance values are given in \autoref{tbl:IS_week}, and \autoref{fig:IS_week_comp} compares the day-over-day performance of the various strategies. 

Most of the observations from the previous section apply here. Chiefly, the illiquid stock \texttt{FARO} produces negative PnL and the low-liquidity stock \texttt{NTAP} approximately breaks even. As expected, the week offset calibration underperforms same-day calibration, but remarkably the difference is very small: in the case of \texttt{INTC}, the discrete time controller still generates a Sharpe ratio of approximately 2.5, and in this case only returned negative PnL once during the trading year. 

The similarity of the results can be interpreted in several ways. First, it is possible that trading behaviour is stable across days of the week, such that substituting one Monday for another yields a similar calibration. This is readily testable by calibrating on a given day and backtesting on the subsequent trading day, instead of a one-week offset. On the other hand, even with dissimilar data, it's possible that the calculation of $\delta^\pm$ is stable with respect to day-over-day fluctuations of data.

\begin{figure}
\centering
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{IS_week_FARO}
  \input{Figs/IS_week_FARO.tikz}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{IS_week_NTAP}
  \input{Figs/IS_week_NTAP.tikz} 
\end{subfigure}\\
\vspace{1cm}
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{IS_week_ORCL}
  \input{Figs/IS_week_ORCL.tikz}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{IS_week_INTC}
  \input{Figs/IS_week_INTC.tikz} 
\end{subfigure}\\

\leavevmode\smash{\makebox[0pt]{\hspace{-7em}% HORIZONTAL POSITION           
  \rotatebox[origin=l]{90}{\hspace{20em}% VERTICAL POSITION
    Normalized PnL}%
}}\hspace{0pt plus 1filll}\null

Trading Day Number of 2013

\vspace{1cm}
\begin{subfigure}{\linewidth}
  %\centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{strategylegend}
  \resizebox{\linewidth}{!}{\input{Figs/strategylegend.tikz}}
\end{subfigure}%
  \caption{End of day strategy performances: in-sample backtesting using a one-week offset for calibration.}
  \label{fig:IS_week_comp}
\end{figure}

\begin{table}
\centering
\ra{1.2}
\begin{tabular}{@{} *{9}{r} @{}}
\toprule
Strategy & Return & Sharpe & \# MO & \# LO & Inv & \% Win & Max Loss & Max Win \\
\midrule
\multicolumn{9}{l}{\texttt{FARO}} \\ 
Naive & -1.072 & -0.444 & 435 & 0 & 1.74 & 0.08 & -34.276 & 2.984 \\ 
Naive+ & 0.045 & 0.046 & 0 & 213 & 2.26 & 0.74 & -8.764 & 5.363 \\ 
Naive++ & -0.003 & -0.027 & 0 & 6 & 0.25 & 0.50 & -1.138 & 0.444 \\ 
Cts & -0.060 & -0.565 & 53 & 149 & 0.08 & 0.20 & -0.955 & 0.077 \\ 
Dscr & -0.076 & -0.764 & 80 & 133 & -0.07 & 0.07 & -1.004 & 0.084 \\ 
Cts w nFPC & -0.065 & -0.590 & 56 & 149 & 0.09 & 0.17 & -1.022 & 0.072 \\ 
Dscr w nFPC & -0.076 & -0.778 & 78 & 133 & 0.07 & 0.07 & -0.904 & 0.053 \\[2ex]
\multicolumn{9}{l}{\texttt{NTAP}} \\ 
Naive & -0.303 & -0.316 & 854 & 0 & -10.96 & 0.20 & -9.463 & 4.349 \\ 
Naive+ & 0.290 & 0.122 & 0 & 3537 & -13.83 & 0.73 & -19.806 & 10.266 \\ 
Naive++ & -0.048 & -0.084 & 0 & 156 & -1.79 & 0.52 & -6.310 & 2.670 \\ 
Cts & -0.016 & -0.165 & 830 & 1405 & 0.37 & 0.52 & -0.612 & 0.158 \\ 
Dscr & 0.070 & 0.593 & 460 & 1388 & 5.06 & 0.79 & -0.355 & 0.858 \\ 
Cts w nFPC & -0.156 & -0.987 & 1506 & 1425 & 0.70 & 0.09 & -1.083 & 0.106 \\ 
Dscr w nFPC & 0.091 & 0.656 & 332 & 1401 & 3.16 & 0.85 & -0.416 & 1.048 \\[2ex]
\multicolumn{9}{l}{\texttt{ORCL}} \\ 
Naive & -0.112 & -0.248 & 492 & 0 & 3.66 & 0.28 & -3.197 & 2.452 \\ 
Naive+ & 0.066 & 0.022 & 0 & 4049 & -50.06 & 0.64 & -17.396 & 18.873 \\ 
Naive++ & 0.002 & 0.005 & 0 & 134 & 0.64 & 0.49 & -1.691 & 2.537 \\ 
Cts & 0.098 & 1.181 & 545 & 1318 & 1.86 & 0.90 & -0.203 & 0.310 \\ 
Dscr & 0.126 & 1.547 & 578 & 1310 & 4.01 & 0.97 & -0.097 & 0.505 \\ 
Cts w nFPC & -0.013 & -0.130 & 1069 & 1365 & 1.39 & 0.47 & -0.528 & 0.500 \\ 
Dscr w nFPC & 0.135 & 1.459 & 416 & 1338 & 3.16 & 0.96 & -0.192 & 0.516 \\[2ex]
\multicolumn{9}{l}{\texttt{INTC}} \\ 
Naive & -0.057 & -0.179 & 274 & 0 & -3.63 & 0.31 & -0.954 & 1.766 \\ 
Naive+ & 0.375 & 0.138 & 0 & 3925 & -25.43 & 0.65 & -11.060 & 11.465 \\ 
Naive++ & 0.013 & 0.055 & 0 & 77 & -0.47 & 0.53 & -1.815 & 1.126 \\ 
Cts & 0.202 & 1.995 & 423 & 1139 & 4.76 & 0.98 & -0.139 & 0.513 \\ 
Dscr & 0.226 & 2.494 & 501 & 1136 & 4.62 & 0.99 & -0.029 & 0.560 \\ 
Cts w nFPC & 0.107 & 1.111 & 681 & 1187 & 1.64 & 0.87 & -0.245 & 0.457 \\ 
Dscr w nFPC & 0.215 & 2.027 & 401 & 1156 & 3.78 & 0.99 & -0.118 & 0.647 \\ 
\bottomrule
\end{tabular}
\caption{Averaged strategy performance results: in-sample backtesting using a one-week offset for calibration.}
\label{tbl:IS_week}
\end{table}

\FloatBarrier
\subsection{Annual Calibration}
The second type of out-of-sample backtesting done was to calibrate using data amalgamated from the entire 2013 trading year. This was a very rich calibration source, as it effectively ensured that every possible state of the Markov chain would have had sufficient observations. Further, this caused us to fix the imbalance bins $\rho$ for the entire year, rather than having bins (and hence what it means to be `heavy buy imbalance' and `neutral imbalance') vary each day. Performance values are given in \autoref{tbl:IS_annual}, and \autoref{fig:IS_annual_comp} compares the day-over-day performance of the various strategies. 

Here we backtest only the more liquid of the stocks, \texttt{ORCL} and \texttt{INTC}. In comparing \autoref{tbl:IS_annual} with \autoref{tbl:IS_week}, we note some interesting observations. Again we see the most liquid stock, \texttt{INTC}, posting on average the better results using the strategies, suggesting that utilizing a liquid stock is key.  (\texttt{INTC} started the year at \$21.38 and gained 21.42\% over the year, while \texttt{ORCL} started at \$34.69 and climbed 10.29\%. However, \texttt{NTAP} started at \$34.30 and gained 19.94\%, similar in performance to \texttt{INTC}, and yet performed substantially worse.) Whereas we have seen thus far that the nFPC strategies underperform the regular calibration, here the roles were reversed in terms of performance, number of market orders used, and average inventory held. Across the strategies we see stability in the number of limit orders used, which suggests that this isn't so much strategy dependent as it is externally dependent on outside agents submitting their market orders. In the case of \texttt{ORCL} we see that the Cts Stoch Ctrl strategy was particularly susceptible to the sharp downward spikes on days 55, 100, and 119, which corresponded to large sell-offs in the market. 


\begin{figure}
\centering
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{IS_annual_ORCL}
  \input{Figs/IS_annual_ORCL.tikz}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{IS_annual_INTC}
  \input{Figs/IS_annual_INTC.tikz} 
\end{subfigure}\\

\leavevmode\smash{\makebox[0pt]{\hspace{-7em}% HORIZONTAL POSITION           
  \rotatebox[origin=l]{90}{\hspace{7em}% VERTICAL POSITION
    Normalized PnL}%
}}\hspace{0pt plus 1filll}\null

Trading Day Number of 2013

\vspace{1cm}
\begin{subfigure}{\linewidth}
  %\centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{strategylegend}
  \resizebox{\linewidth}{!}{\input{Figs/strategylegend.tikz}}
\end{subfigure}%
  \caption{End of day strategy performances: in-sample backtesting on 2013 data, using amalgamated annual 2013 data for calibration.}
  \label{fig:IS_annual_comp}
\end{figure}

\begin{table}
\centering
\ra{1.2}
\begin{tabular}{@{} *{9}{r} @{}}
\toprule
Strategy & Return & Sharpe & \# MO & \# LO & Inv & \% Win & Max Loss & Max Win \\
\midrule
\multicolumn{9}{l}{\texttt{ORCL}} \\ 
Cts & -0.089 & -0.875 & 1540 & 1383 & 1.19 & 0.14 & -0.705 & 0.393 \\ 
Dscr & 0.140 & 1.596 & 368 & 1344 & 0.46 & 0.96 & -0.088 & 0.487 \\ 
Cts w nFPC & 0.113 & 1.327 & 476 & 1338 & 2.67 & 0.94 & -0.140 & 0.484 \\ 
Dscr w nFPC & 0.118 & 1.735 & 590 & 1337 & 3.43 & 0.99 & -0.028 & 0.474 \\[2ex]
\multicolumn{9}{l}{\texttt{INTC}} \\ 
Cts & 0.065 & 0.743 & 888 & 1207 & 1.22 & 0.84 & -0.282 & 0.341 \\ 
Dscr & 0.235 & 2.189 & 380 & 1170 & 1.19 & 0.99 & -0.061 & 0.595 \\ 
Cts w nFPC & 0.209 & 2.030 & 396 & 1160 & 5.58 & 0.98 & -0.112 & 0.494 \\ 
Dscr w nFPC & 0.197 & 2.588 & 576 & 1164 & 3.78 & 1.00 &  & 0.490 \\ 
\bottomrule
\end{tabular}
\caption{Averaged strategy performance results: in-sample backtesting on 2013 data, using amalgamated annual 2013 data for calibration.}
\label{tbl:IS_annual}
\end{table}

\FloatBarrier
\section{Out-of-Sample Backtesting}
From the in-sample backtesting we can conclude that xxx.

\begin{figure}
\centering
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{OOS_annual_INTC}
  \input{Figs/OOS_annual_INTC.tikz}
\end{subfigure}%
\hfill%
\begin{subfigure}{.45\linewidth}
  \centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
%  \tikzsetnextfilename{OOS_annual_AAPL}
%  \input{Figs/OOS_annual_AAPL.tikz} 
\end{subfigure}\\

\leavevmode\smash{\makebox[0pt]{\hspace{-7em}% HORIZONTAL POSITION           
  \rotatebox[origin=l]{90}{\hspace{7em}% VERTICAL POSITION
    Normalized PnL}%
}}\hspace{0pt plus 1filll}\null

Trading Day Number of 2014

\vspace{1cm}
\begin{subfigure}{\linewidth}
  %\centering
  \setlength\figureheight{\linewidth} 
  \setlength\figurewidth{\linewidth}
  \tikzsetnextfilename{strategylegend}
  \resizebox{\linewidth}{!}{\input{Figs/strategylegend.tikz}}
\end{subfigure}%
  \caption{End of day strategy performances: out-of-sample backtesting on 2014 data, using amalgamated annual 2013 data for calibration.}
  \label{fig:OOS_annual_comp}
\end{figure}

\begin{table}
\centering
\ra{1.2}
\begin{tabular}{@{} *{9}{r} @{}}
\toprule
Strategy & Return & Sharpe & \# MO & \# LO & Inv & \% Win & Max Loss & Max Win \\
\midrule
\multicolumn{9}{l}{\texttt{INTC}} \\ 
Cts & 0.275 & 2.426 & 1617 & 1821 & -0.00 & 1.00 & -0.013 & 0.760 \\ 
Dscr & 0.394 & 1.727 & 987 & 1732 & -0.15 & 1.00 & -0.027 & 1.609 \\ 
Cts w nFPC & 0.525 & 2.056 & 397 & 1611 & 0.07 & 1.00 &  & 2.145 \\ 
Dscr w nFPC & 0.522 & 2.027 & 392 & 1611 & 0.08 & 1.00 &  & 2.277 \\ [2ex]
\multicolumn{9}{l}{\texttt{AAPL}} \\ 
Cts \\
Dscr \\
Cts w nFPC \\
Dscr w nFPC\\
\bottomrule
\end{tabular}
\caption{Averaged strategy performance results: out-of-sample backtesting on 2014 data, using amalgamated annual 2013 data for calibration.}
\label{tbl:OOS_annual}
\end{table}